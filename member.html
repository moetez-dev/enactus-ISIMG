<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enactus Hub | Member Portal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800;900&family=Source+Sans+3:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <style>
        :root { --enactus-yellow: #FFC222; }
        body { font-family: 'Source Sans 3', sans-serif; background-color: #f8f9fc; }
        .font-heading { font-family: 'Montserrat', sans-serif; }
        .glass-sidebar { background: #000; }
        .sidebar-item:hover { background: var(--enactus-yellow); color: black; transform: translateX(5px); }
        .active-nav { background: var(--enactus-yellow); color: black; }
        .card-shadow { box-shadow: 0 20px 50px -15px rgba(0,0,0,0.05); }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #ddd; border-radius: 10px; }
        
        /* Animation for Member of the Month */
        @keyframes shine { 0% {left: -100%} 100% {left: 100%} }
        .shine-effect::after {
            content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.3), transparent);
            transform: skewX(-25deg); transition: 0.7s;
        }
        .shine-effect:hover::after { animation: shine 1s ease-in-out; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="w-20 lg:w-72 glass-sidebar text-white flex flex-col transition-all duration-300 z-50">
        <div class="p-8 mb-4 flex items-center gap-3">
            <div class="w-10 h-10 bg-[#FFC222] rounded-2xl flex items-center justify-center shadow-lg shadow-yellow-500/20">
                <i data-lucide="zap" class="text-black w-6 h-6"></i>
            </div>
            <span class="font-heading text-xl font-black hidden lg:block tracking-tighter uppercase">Enactus <span class="text-[#FFC222]">Hub</span></span>
        </div>

        <nav class="flex-1 px-4 space-y-2 mt-4">
            <a href="#" class="sidebar-item active-nav flex items-center gap-4 p-4 rounded-2xl font-bold transition-all">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i> <span class="hidden lg:block text-sm uppercase tracking-widest">Dashboard</span>
            </a>
            <a href="#" class="sidebar-item flex items-center gap-4 p-4 rounded-2xl opacity-40 hover:opacity-100 transition-all">
                <i data-lucide="folder-kanban" class="w-5 h-5"></i> <span class="hidden lg:block text-sm uppercase tracking-widest">My Projects</span>
            </a>
            <a href="#" class="sidebar-item flex items-center gap-4 p-4 rounded-2xl opacity-40 hover:opacity-100 transition-all">
                <i data-lucide="library" class="w-5 h-5"></i> <span class="hidden lg:block text-sm uppercase tracking-widest">E-Library</span>
            </a>
            <a href="#" class="sidebar-item flex items-center gap-4 p-4 rounded-2xl opacity-40 hover:opacity-100 transition-all">
                <i data-lucide="settings" class="w-5 h-5"></i> <span class="hidden lg:block text-sm uppercase tracking-widest">Settings</span>
            </a>
        </nav>

        <div class="p-6 border-t border-white/5">
            <button onclick="logout()" class="flex items-center gap-4 p-4 w-full rounded-2xl text-red-400 hover:bg-red-500/10 transition-all font-black uppercase text-xs tracking-widest">
                <i data-lucide="log-out" class="w-5 h-5"></i> <span class="hidden lg:block">Sign Out</span>
            </button>
        </div>
    </aside>

    <div class="flex-1 flex flex-col h-screen overflow-hidden">
        
        <header class="bg-white/80 backdrop-blur-xl border-b px-8 py-4 flex justify-between items-center h-20 flex-shrink-0 z-40">
            <div class="flex items-center gap-4">
                <div id="statusTag" class="px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-[0.2em] bg-green-100 text-green-600 border border-green-200">
                    Active Member
                </div>
            </div>
            
            <div class="flex items-center gap-6">
                <div class="text-right flex flex-col">
                    <span id="userNameDisplay" class="text-sm font-black text-black uppercase tracking-tight italic">Enactor</span>
                    <span id="userDept" class="text-[9px] font-bold text-gray-400 uppercase tracking-widest">Department Name</span>
                </div>
                <div class="w-11 h-11 rounded-2xl bg-zinc-900 border-2 border-[#FFC222] p-0.5 shadow-lg overflow-hidden">
                    <img id="userAvatar" src="https://ui-avatars.com/api/?name=User&background=000&color=FFC222" class="w-full h-full rounded-xl object-cover">
                </div>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto custom-scrollbar p-6 lg:p-10 space-y-10">
            
            <div id="interviewBanner" class="hidden bg-blue-600 text-white p-6 rounded-[2.5rem] flex items-center justify-between shadow-xl shadow-blue-500/20 animate-pulse transition-all">
                <div class="flex items-center gap-5">
                    <div class="bg-white/20 p-4 rounded-2xl border border-white/30"><i data-lucide="calendar"></i></div>
                    <div>
                        <h4 class="font-black font-heading uppercase tracking-widest text-xs mb-1">Interview Scheduled!</h4>
                        <p id="interviewMsg" class="text-sm font-medium opacity-90">Check your email for details.</p>
                    </div>
                </div>
            </div>

            <div class="grid lg:grid-cols-12 gap-10">
                
                <div class="lg:col-span-8 space-y-10">
                    
                    <div class="bg-white p-10 lg:p-16 rounded-[4rem] card-shadow border border-gray-100 relative overflow-hidden group">
                        <div class="relative z-10">
                            <h2 class="text-4xl lg:text-6xl font-black font-heading leading-none mb-6">IMPACT <br><span class="text-[#FFC222]">STARTS HERE.</span></h2>
                            <p class="text-gray-400 font-semibold text-lg max-w-md italic mb-8">"Entrepreneurial action for others creates a better world for us all."</p>
                            <div class="flex gap-4">
                                <button class="bg-black text-white px-8 py-3 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-[#FFC222] hover:text-black transition-all">Explore Projects</button>
                            </div>
                        </div>
                        <i data-lucide="globe" class="absolute -right-10 -bottom-10 w-64 h-64 text-gray-50 group-hover:text-yellow-50 transition-colors"></i>
                    </div>

                    <div class="space-y-6">
                        <div class="flex items-center justify-between">
                            <h3 class="font-black text-2xl font-heading flex items-center gap-3">
                                <i data-lucide="zap" class="text-[#FFC222]"></i> Club Updates
                            </h3>
                        </div>
                        <div id="newsFeed" class="grid gap-6">
                            </div>
                    </div>
                </div>

                <div class="lg:col-span-4 space-y-10">
                    
                    <div class="bg-black p-8 rounded-[3rem] shadow-2xl relative overflow-hidden shine-effect group">
                        <div class="relative z-10 flex flex-col items-center text-center">
                            <div class="mb-5 relative">
                                <div class="w-24 h-24 rounded-3xl border-4 border-[#FFC222]/30 overflow-hidden shadow-2xl rotate-3 group-hover:rotate-0 transition-transform">
                                    <img id="motmImage" src="https://ui-avatars.com/api/?name=Winner&background=FFC222&color=000" class="w-full h-full object-cover">
                                </div>
                                <div class="absolute -bottom-3 -right-3 bg-[#FFC222] text-black p-2.5 rounded-2xl shadow-xl">
                                    <i data-lucide="crown" class="w-5 h-5"></i>
                                </div>
                            </div>
                            <h4 class="text-[#FFC222] font-black font-heading uppercase text-[10px] tracking-[0.3em] mb-2">Member of the Month</h4>
                            <h3 id="motmName" class="text-white text-2xl font-black">Loading...</h3>
                        </div>
                    </div>

                    <div class="bg-white p-8 rounded-[3rem] card-shadow border border-gray-100">
                        <h3 class="font-black text-[11px] uppercase tracking-[0.2em] text-gray-400 mb-8 flex items-center gap-2">
                            <i data-lucide="bar-chart-3" class="w-4 h-4"></i> Top Ranking Enactors
                        </h3>
                        <div id="leaderboardList" class="space-y-5">
                            </div>
                    </div>

                    <div class="bg-white rounded-[3rem] card-shadow border border-gray-100 overflow-hidden flex flex-col h-[450px]">
                        <div class="p-6 border-b flex items-center justify-between bg-zinc-900 text-white">
                            <span class="font-black text-[10px] uppercase tracking-widest flex items-center gap-2">
                                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Team Chat
                            </span>
                            <i data-lucide="message-circle" class="w-4 h-4 opacity-50"></i>
                        </div>
                        <div id="chatMessages" class="flex-grow p-6 overflow-y-auto custom-scrollbar space-y-4 bg-gray-50 flex flex-col"></div>
                        <form id="chatForm" class="p-4 bg-white border-t flex gap-2">
                            <input type="text" id="chatInput" placeholder="Type a message..." class="flex-grow p-3 text-xs bg-gray-100 rounded-2xl outline-none focus:ring-2 ring-yellow-400 transition-all font-semibold">
                            <button class="bg-black text-white p-3 rounded-2xl hover:bg-yellow-400 hover:text-black transition-all">
                                <i data-lucide="send" class="w-4 h-4"></i>
                            </button>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyDL5ZWW6ofy9SFXw7tMSVxM34k9BDecrjI",
            authDomain: "enactus-isimg-99469.firebaseapp.com",
            projectId: "enactus-isimg-99469",
            storageBucket: "enactus-isimg-99469.firebasestorage.app",
            messagingSenderId: "348185800306",
            appId: "1:348185800306:web:31e228e4bb631e18a91ceb"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let currentUserData = null;

        lucide.createIcons();

        // 1. AUTH & PROFILE SYNC
        auth.onAuthStateChanged(user => {
            if (user) {
                db.collection("users").doc(user.uid).onSnapshot(doc => {
                    const data = doc.data();
                    if (!data || (data.status === "pending" && data.role !== "admin")) {
                        window.location.href = "login.html";
                        return;
                    }
                    currentUserData = data;
                    syncUI(data);
                });
                loadChat();
                loadFeed();
                loadLeaderboard();
            } else {
                window.location.href = "login.html";
            }
        });

        function syncUI(data) {
            document.getElementById('userNameDisplay').innerText = data.fullName;
            document.getElementById('userDept').innerText = data.department || "Enactus Member";
            if(data.profilePic) document.getElementById('userAvatar').src = data.profilePic;

            // Status Banner Logic
            const banner = document.getElementById('interviewBanner');
            if(data.status === "interview") {
                banner.classList.remove('hidden');
                document.getElementById('interviewMsg').innerText = data.notification || "The board invited you for an interview! Check your inbox.";
            } else {
                banner.classList.add('hidden');
            }
        }

        // 2. LEADERBOARD & MEMBER OF THE MONTH
        function loadLeaderboard() {
            db.collection("users").orderBy("points", "desc").limit(5).onSnapshot(snap => {
                const list = document.getElementById('leaderboardList');
                list.innerHTML = "";
                let i = 0;
                snap.forEach(doc => {
                    const u = doc.data();
                    const isTop = i === 0;
                    list.innerHTML += `
                        <div class="flex items-center justify-between p-2 rounded-2xl">
                            <div class="flex items-center gap-3">
                                <span class="w-6 text-xs font-black ${isTop ? 'text-yellow-500' : 'text-gray-300'}">0${i+1}</span>
                                <div class="w-8 h-8 rounded-lg bg-gray-100 overflow-hidden border border-gray-100">
                                    <img src="${u.profilePic || 'https://ui-avatars.com/api/?name='+u.fullName}" class="w-full h-full object-cover">
                                </div>
                                <p class="text-[11px] font-black uppercase tracking-tight">${u.fullName}</p>
                            </div>
                            <span class="text-[10px] font-black bg-gray-50 px-2 py-1 rounded-md tracking-widest">${u.points || 0} PTS</span>
                        </div>
                    `;
                    if(isTop) {
                        document.getElementById('motmName').innerText = u.fullName;
                        if(u.profilePic) document.getElementById('motmImage').src = u.profilePic;
                    }
                    i++;
                });
            });
        }

        // 3. CHAT LOGIC
        function loadChat() {
            db.collection("messages").orderBy("createdAt", "asc").limitToLast(30).onSnapshot(snap => {
                const box = document.getElementById('chatMessages');
                box.innerHTML = "";
                snap.forEach(doc => {
                    const m = doc.data();
                    const isMe = m.senderId === auth.currentUser.uid;
                    const d = document.createElement('div');
                    d.className = `max-w-[85%] p-3 rounded-[1.5rem] text-xs font-bold ${isMe ? 'bg-black text-white self-end rounded-tr-none' : 'bg-white border self-start rounded-tl-none'}`;
                    d.innerHTML = `<p class="text-[8px] uppercase opacity-40 mb-1">${m.senderName}</p><p>${m.text}</p>`;
                    box.appendChild(d);
                });
                box.scrollTop = box.scrollHeight;
            });
        }

        document.getElementById('chatForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const inp = document.getElementById('chatInput');
            if(!inp.value.trim() || !currentUserData) return;
            await db.collection("messages").add({
                text: inp.value,
                senderId: auth.currentUser.uid,
                senderName: currentUserData.fullName,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            inp.value = "";
        });

        // 4. NEWS FEED
        function loadFeed() {
            db.collection("news").orderBy("createdAt", "desc").limit(5).onSnapshot(snap => {
                const feed = document.getElementById('newsFeed');
                feed.innerHTML = "";
                snap.forEach(doc => {
                    const n = doc.data();
                    feed.innerHTML += `
                        <div class="bg-white p-8 rounded-[3rem] border border-gray-100 card-shadow group hover:border-yellow-400 transition-all">
                            <div class="flex justify-between items-start mb-4">
                                <h4 class="font-black text-xl uppercase tracking-tighter">${n.title}</h4>
                                <span class="text-[10px] font-black text-gray-300 italic">Recently</span>
                            </div>
                            <p class="text-gray-400 font-medium text-sm leading-relaxed mb-6">${n.desc}</p>
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 rounded-full bg-black flex items-center justify-center"><i data-lucide="shield-check" class="w-3 h-3 text-white"></i></div>
                                <span class="text-[9px] font-black uppercase tracking-[0.2em]">Verified Update</span>
                            </div>
                        </div>
                    `;
                });
                lucide.createIcons();
            });
        }

        function logout() { auth.signOut().then(() => window.location.href = "index.html"); }
    </script>
</body>
</html>