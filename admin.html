<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enactus Hub | Admin Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800;900&family=Source+Sans+3:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --enactus-yellow: #FFC222; }
        body { font-family: 'Source Sans 3', sans-serif; background: #f8fafc; }
        .font-heading { font-family: 'Montserrat', sans-serif; }
        .sidebar-link.active { background: var(--enactus-yellow); color: black; }
        .section-content { display: none; animation: slideUp 0.3s ease-out; }
        .section-content.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex min-h-screen">

    <aside class="w-72 bg-black text-white p-8 flex flex-col fixed h-full z-50">
        <div class="mb-12 flex items-center gap-3">
            <div class="w-10 h-10 bg-yellow-400 rounded-2xl flex items-center justify-center italic font-black text-black text-xl">A</div>
            <h1 class="font-heading text-xl tracking-tighter uppercase">Admin<span class="text-yellow-400 italic">Panel</span></h1>
        </div>

        <nav class="space-y-3 flex-1">
            <button onclick="showSection('reviews', this)" class="sidebar-link active w-full text-left p-4 rounded-2xl transition-all font-bold flex items-center gap-3 opacity-70 hover:opacity-100">
                <i data-lucide="clipboard-check"></i> Submissions
            </button>
            <button onclick="showSection('tasks', this)" class="sidebar-link w-full text-left p-4 rounded-2xl transition-all font-bold flex items-center gap-3 opacity-70 hover:opacity-100">
                <i data-lucide="plus-square"></i> Assign Mission
            </button>
            <button onclick="showSection('projects', this)" class="sidebar-link w-full text-left p-4 rounded-2xl transition-all font-bold flex items-center gap-3 opacity-70 hover:opacity-100">
                <i data-lucide="rocket"></i> Hub Projects
            </button>
            <button onclick="showSection('calendar', this)" class="sidebar-link w-full text-left p-4 rounded-2xl transition-all font-bold flex items-center gap-3 opacity-70 hover:opacity-100">
                <i data-lucide="calendar"></i> Timeline
            </button>
            <button onclick="showSection('broadcast', this)" class="sidebar-link w-full text-left p-4 rounded-2xl transition-all font-bold flex items-center gap-3 opacity-70 hover:opacity-100">
                <i data-lucide="megaphone"></i> Broadcast
            </button>
        </nav>

        <button onclick="logout()" class="p-4 text-red-400 font-black uppercase text-xs tracking-widest flex items-center gap-3 mt-auto">
            <i data-lucide="log-out"></i> Sign Out
        </button>
    </aside>

    <main class="flex-1 ml-72 p-12">
        
        <section id="reviewsSection" class="section-content active space-y-8">
            <div class="flex justify-between items-end">
                <h2 class="text-4xl font-black font-heading uppercase italic underline decoration-blue-500 decoration-8">Review Work</h2>
                <span class="text-xs font-bold text-gray-400 uppercase italic">Pending Submissions</span>
            </div>
            <div id="submissionsList" class="grid gap-6">
                </div>
        </section>

        <section id="tasksSection" class="section-content space-y-8">
            <h2 class="text-4xl font-black font-heading uppercase italic underline decoration-yellow-400 decoration-8">New Mission</h2>
            <div class="bg-white p-10 rounded-[3rem] shadow-2xl border border-gray-100 max-w-2xl">
                <div class="space-y-6">
                    <div>
                        <label class="block text-[10px] font-black uppercase text-gray-400 mb-2 ml-2">Target Enactor</label>
                        <select id="taskMember" class="w-full p-5 bg-gray-50 rounded-[1.5rem] font-bold border-2 border-transparent focus:border-yellow-400 outline-none transition"></select>
                    </div>
                    <div>
                        <label class="block text-[10px] font-black uppercase text-gray-400 mb-2 ml-2">Mission Description</label>
                        <input type="text" id="taskText" placeholder="e.g. Design 3 Instagram Posts" class="w-full p-5 bg-gray-50 rounded-[1.5rem] font-bold border-2 border-transparent focus:border-yellow-400 outline-none transition">
                    </div>
                    <button onclick="assignTask()" class="w-full py-5 bg-black text-white rounded-[1.5rem] font-black uppercase tracking-widest hover:bg-yellow-400 hover:text-black transition transform active:scale-95">Deploy Mission</button>
                </div>
            </div>
        </section>

        <section id="projectsSection" class="section-content space-y-8">
            <h2 class="text-4xl font-black font-heading uppercase italic underline decoration-green-400 decoration-8">Project Hub</h2>
            <div class="bg-white p-10 rounded-[3rem] shadow-2xl border border-gray-100 max-w-2xl">
                <div class="space-y-6">
                    <input type="text" id="pName" placeholder="Project Name" class="w-full p-5 bg-gray-50 rounded-[1.5rem] font-bold outline-none">
                    <div class="flex items-center gap-4">
                        <input type="number" id="pProgress" placeholder="Progress %" class="flex-1 p-5 bg-gray-50 rounded-[1.5rem] font-bold outline-none">
                        <span class="font-black text-xl">%</span>
                    </div>
                    <button onclick="updateProject()" class="w-full py-5 bg-black text-white rounded-[1.5rem] font-black uppercase tracking-widest hover:bg-green-400 transition">Update Member Hub</button>
                </div>
            </div>
        </section>

        <section id="calendarSection" class="section-content space-y-8">
            <h2 class="text-4xl font-black font-heading uppercase italic underline decoration-orange-400 decoration-8">Events Planner</h2>
            <div class="bg-white p-10 rounded-[3rem] shadow-2xl border border-gray-100 max-w-2xl">
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="eDate" placeholder="Date (e.g. 20 MAR)" class="p-5 bg-gray-50 rounded-[1.5rem] font-bold outline-none">
                    <input type="text" id="eTitle" placeholder="Event Name" class="p-5 bg-gray-50 rounded-[1.5rem] font-bold outline-none">
                    <textarea id="eDesc" placeholder="Event Details..." class="col-span-2 p-5 bg-gray-50 rounded-[1.5rem] h-32 font-bold outline-none"></textarea>
                    <button onclick="addEvent()" class="col-span-2 py-5 bg-black text-white rounded-[1.5rem] font-black uppercase tracking-widest hover:bg-orange-400 transition">Schedule Event</button>
                </div>
            </div>
        </section>

        <section id="broadcastSection" class="section-content space-y-8">
            <h2 class="text-4xl font-black font-heading uppercase italic underline decoration-red-400 decoration-8">Club News</h2>
            <div class="bg-white p-10 rounded-[3rem] shadow-2xl border border-gray-100 max-w-2xl">
                <div class="space-y-6">
                    <input type="text" id="nTitle" placeholder="Announcement Title" class="w-full p-5 bg-gray-50 rounded-[1.5rem] font-bold outline-none">
                    <textarea id="nDesc" placeholder="Content..." class="w-full p-5 bg-gray-50 rounded-[1.5rem] h-32 font-bold outline-none"></textarea>
                    <button onclick="publishNews()" class="w-full py-5 bg-black text-white rounded-[1.5rem] font-black uppercase tracking-widest hover:bg-red-500 transition">Broadcast Globally</button>
                </div>
            </div>
        </section>

    </main>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDL5ZWW6ofy9SFXw7tMSVxM34k9BDecrjI",
            authDomain: "enactus-isimg-99469.firebaseapp.com",
            projectId: "enactus-isimg-99469",
            storageBucket: "enactus-isimg-99469.firebasestorage.app",
            messagingSenderId: "348185800306",
            appId: "1:348185800306:web:31e228e4bb631e18a91ceb"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        lucide.createIcons();

        function showSection(id, btn) {
            document.querySelectorAll('.section-content').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
            document.getElementById(id + 'Section').classList.add('active');
            btn.classList.add('active');
        }

        // Fetch Members for Dropdown
        db.collection("users").onSnapshot(snap => {
            const select = document.getElementById('taskMember');
            select.innerHTML = '<option value="">-- Choose Member --</option>';
            snap.forEach(doc => {
                if(doc.data().role !== 'admin') {
                    select.innerHTML += `<option value="${doc.id}">${doc.data().fullName} (${doc.data().department || 'No Dept'})</option>`;
                }
            });
        });

        // Review Submissions in Real-time
        db.collection("tasks").where("status", "==", "pending_review").onSnapshot(snap => {
            const list = document.getElementById('submissionsList');
            list.innerHTML = snap.empty ? '<p class="font-bold text-gray-400 italic">No submissions to review right now.</p>' : "";
            
            snap.forEach(doc => {
                const t = doc.data();
                db.collection("users").doc(t.uid).get().then(uDoc => {
                    const u = uDoc.data();
                    list.innerHTML += `
                        <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border-l-8 border-blue-500 flex justify-between items-center animate-in">
                            <div class="flex items-center gap-6">
                                <img src="${u.profilePic || 'https://ui-avatars.com/api/?name='+u.fullName}" class="w-16 h-16 rounded-2xl object-cover">
                                <div>
                                    <p class="text-[10px] font-black text-blue-500 uppercase tracking-widest">${u.fullName}</p>
                                    <h4 class="text-xl font-black italic uppercase">${t.text}</h4>
                                    <a href="${t.workLink}" target="_blank" class="text-xs text-blue-400 underline font-bold italic">Click to view work</a>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <button onclick="approveWork('${doc.id}', '${t.uid}')" class="bg-green-500 text-white px-8 py-4 rounded-2xl font-black uppercase text-xs hover:bg-black transition shadow-lg shadow-green-200">Approve & +50</button>
                                <button onclick="rejectWork('${doc.id}')" class="bg-red-100 text-red-500 px-8 py-4 rounded-2xl font-black uppercase text-xs hover:bg-red-500 hover:text-white transition">Reject</button>
                            </div>
                        </div>`;
                });
            });
        });

        async function approveWork(tId, uId) {
            await db.collection("tasks").doc(tId).update({ status: "approved", completed: true });
            const userRef = db.collection("users").doc(uId);
            const user = await userRef.get();
            await userRef.update({ points: (user.data().points || 0) + 50 });
            alert("Mission validated! Member received 50 points.");
        }

        async function rejectWork(id) {
            await db.collection("tasks").doc(id).update({ status: "live", submitted: false });
            alert("Work rejected. Member can re-submit.");
        }

        // Admin Functions
        async function assignTask() {
            const uid = document.getElementById('taskMember').value;
            const text = document.getElementById('taskText').value;
            if(!uid || !text) return alert("Select member and write task!");
            await db.collection("tasks").add({ uid, text, completed: false, submitted: false, status: "live", createdAt: new Date() });
            alert("Mission Deployed!");
        }

        async function updateProject() {
            const name = document.getElementById('pName').value;
            const progress = document.getElementById('pProgress').value;
            await db.collection("projects").doc(name.toLowerCase()).set({ name, progress: parseInt(progress) });
            alert("Hub Updated!");
        }

        async function addEvent() {
            const date = document.getElementById('eDate').value;
            const title = document.getElementById('eTitle').value;
            const desc = document.getElementById('eDesc').value;
            await db.collection("events").add({ date, title, description: desc, createdAt: new Date() });
            alert("Event Published!");
        }

        async function publishNews() {
            const title = document.getElementById('nTitle').value;
            const desc = document.getElementById('nDesc').value;
            await db.collection("news").add({ title, desc, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
            alert("Broadcast Sent!");
        }

        function logout() { auth.signOut().then(() => window.location.href = "login.html"); }
    </script>
</body>
</html>