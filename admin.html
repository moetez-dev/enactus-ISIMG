<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | Enactus ISIMG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Source+Sans+3:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Source Sans 3', sans-serif; background: #f0f2f5; }
        .font-heading { font-family: 'Montserrat', sans-serif; }
    </style>
</head>
<body class="flex min-h-screen">

    <aside class="w-64 bg-black text-white p-6 flex flex-col">
        <h1 class="font-heading text-2xl mb-10 text-[#FFC222]">ADMIN <span class="text-white">HUB</span></h1>
        <nav class="space-y-4 flex-1">
            <button onclick="showSection('members')" class="w-full text-left p-3 rounded-xl hover:bg-[#FFC222] hover:text-black transition font-bold flex items-center gap-3">
                <i data-lucide="users"></i> Members
            </button>
            <button onclick="showSection('news')" class="w-full text-left p-3 rounded-xl hover:bg-[#FFC222] hover:text-black transition font-bold flex items-center gap-3">
                <i data-lucide="megaphone"></i> Publish News
            </button>
        </nav>
        <button onclick="logout()" class="p-3 text-red-400 font-bold flex items-center gap-3"><i data-lucide="log-out"></i> Logout</button>
    </aside>

    <main class="flex-1 p-10">
        
        <section id="membersSection" class="space-y-6">
            <h2 class="text-3xl font-black font-heading uppercase italic">Manage Enactors</h2>
            <div class="bg-white rounded-[2rem] shadow-sm overflow-hidden border border-gray-100">
                <table class="w-full text-left">
                    <thead class="bg-gray-50 border-b">
                        <tr>
                            <th class="p-5 text-xs font-black uppercase tracking-widest text-gray-400">Name</th>
                            <th class="p-5 text-xs font-black uppercase tracking-widest text-gray-400">Status</th>
                            <th class="p-5 text-xs font-black uppercase tracking-widest text-gray-400">Points</th>
                            <th class="p-5 text-xs font-black uppercase tracking-widest text-gray-400">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="membersTable" class="divide-y divide-gray-50">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="newsSection" class="hidden space-y-6">
            <h2 class="text-3xl font-black font-heading uppercase italic">Broadcast Update</h2>
            <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-gray-100 max-w-2xl">
                <input type="text" id="newsTitle" placeholder="Update Title" class="w-full p-4 bg-gray-50 rounded-2xl mb-4 outline-none focus:ring-2 ring-yellow-400 font-bold">
                <textarea id="newsDesc" placeholder="What's happening in the club?" class="w-full p-4 bg-gray-50 rounded-2xl mb-6 h-32 outline-none focus:ring-2 ring-yellow-400 font-semibold"></textarea>
                <button onclick="publishNews()" class="bg-black text-white px-10 py-4 rounded-2xl font-black uppercase tracking-widest text-xs hover:bg-[#FFC222] hover:text-black transition-all">Publish to Feed</button>
            </div>
        </section>

    </main>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDL5ZWW6ofy9SFXw7tMSVxM34k9BDecrjI",
            authDomain: "enactus-isimg-99469.firebaseapp.com",
            projectId: "enactus-isimg-99469",
            storageBucket: "enactus-isimg-99469.firebasestorage.app",
            messagingSenderId: "348185800306",
            appId: "1:348185800306:web:31e228e4bb631e18a91ceb"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        lucide.createIcons();

        // 1. Navigation
        function showSection(id) {
            document.getElementById('membersSection').classList.add('hidden');
            document.getElementById('newsSection').classList.add('hidden');
            document.getElementById(id + 'Section').classList.remove('hidden');
        }

        // 2. Load Members
        db.collection("users").onSnapshot(snap => {
            const table = document.getElementById('membersTable');
            table.innerHTML = "";
            snap.forEach(doc => {
                const u = doc.data();
                if(u.role === 'admin') return;

                table.innerHTML += `
                    <tr>
                        <td class="p-5">
                            <p class="font-black text-sm uppercase">${u.fullName}</p>
                            <p class="text-[10px] text-gray-400">${u.email}</p>
                        </td>
                        <td class="p-5">
                            <span class="px-3 py-1 rounded-full text-[9px] font-black uppercase ${u.status === 'approved' ? 'bg-green-100 text-green-600' : 'bg-blue-100 text-blue-600'}">${u.status}</span>
                        </td>
                        <td class="p-5 font-black text-sm">${u.points || 0}</td>
                        <td class="p-5 space-x-2">
                            <button onclick="updateStatus('${doc.id}', 'interview')" class="text-[10px] font-black uppercase text-blue-500 hover:underline">Interview</button>
                            <button onclick="updateStatus('${doc.id}', 'approved')" class="text-[10px] font-black uppercase text-green-500 hover:underline">Approve</button>
                            <button onclick="addPoints('${doc.id}', ${u.points || 0})" class="text-[10px] font-black uppercase text-yellow-600 hover:underline">+10 Pts</button>
                        </td>
                    </tr>
                `;
            });
        });

        // 3. Admin Actions
        async function updateStatus(id, newStatus) {
            await db.collection("users").doc(id).update({ status: newStatus });
            alert("Status updated to " + newStatus);
        }

        async function addPoints(id, currentPoints) {
            await db.collection("users").doc(id).update({ points: currentPoints + 10 });
        }

        async function publishNews() {
            const title = document.getElementById('newsTitle').value;
            const desc = document.getElementById('newsDesc').value;
            if(!title || !desc) return alert("Fill all fields");

            await db.collection("news").add({
                title: title,
                desc: desc,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            alert("News published!");
            document.getElementById('newsTitle').value = "";
            document.getElementById('newsDesc').value = "";
        }

        function logout() { auth.signOut().then(() => window.location.href = "login.html"); }
    </script>
</body>
</html>